# telegrambot — TODO (from code + logs scan)

## P0 — stability (fix/verify before serious testing)
- [ ] Live-test: post-join verification “unmute” restores media permissions (photos/docs/etc).
- [ ] Live-test: admin `/actions` + `/unmute` can’t target the bot (replying to bot messages should be blocked).
- [ ] Live-test: moderation commands work with `@username` (fallback `getChat(@username)`), otherwise show a clear “need reply or user id” message.
- [ ] Investigate/handle webhook update crashes caused by Telegram “chat not found” (seen during `/start cfg_*`): treat as a handled/expected error, not a server error.
- [ ] Confirm Mercle identity-link conflicts are handled cleanly (no DB IntegrityError; user sees “account already linked” message).

## P1 — correctness + UX polish
- [ ] Make join prompt / verification messages less noisy and more human (short text, clear CTA, avoid repeating “verify to chat”).
- [ ] Ensure “locks” and “antiflood” behaviors are consistent and configurable (`silent_automations`, warning text, mute duration).
- [ ] Ensure custom roles are easy to use: add a short “how to grant roles” help (`/roles` usage + what `/mycommands` shows).
- [ ] Reduce log noise further (expected Telegram errors: kicked/forbidden/chat not found → debug/info, not ERROR).

## P2 — ops + repo hygiene
- [ ] Ensure the systemd service survives reboot: `systemctl enable telegrambot` + reboot test.
- [ ] Remove tracked SQLite/log artifacts from git (SQLite is no longer used): `bot_db.sqlite`, `bot.db`, `bot.log`.

## Manual regression checklist (quick)
- [ ] Bot added to group → setup card appears; `/checkperms` matches expected bot perms.
- [ ] Join (unverified user) → restricted + prompt posted; DM deep-link opens panel; Mercle verify → user can speak + send media.
- [ ] Join gate (join requests) → DM sent via `user_chat_id`; verify → approve request; expiry → decline.
- [ ] `/report` (reply) → admin log entry created and forwarded to logs destination (if configured).
- [ ] `/actions` (reply) → kick/ban/mute/unmute/warn flows work; no action on bots.
